name: Build the runtime
on: workflow_dispatch
jobs:
    build:
        runs-on: ubuntu-latest
        container:
            image: ubuntu:18.04
            env:
                LANG: C.UTF-8
        steps:
            - name: Checkout this repository.
              uses: actions/checkout@v3
              with:
                path: main
            - name: Clone runtimezilla
              uses: actions/checkout@v3
              with:
                repository: mirkobrombin/runtimezilla
                ref: 0.1
                path: runtimezilla 
            - name: Enable i386 arch
              run: dpkg --add-architecture i386

            - name: Update repository
              run: apt-get -qq update

            - name: Install python
              run: apt-get install python3 python3-pip -y

            - name: Install python deps
              run: python3 -m pip install -r runtimezilla/requirements.txt

            - name: Build runtime
              env: 
                PYTHONUTF8: 1
                PYTHONIOENCODING: UTF-8
              run: python3 runtimezilla/runtimezilla --recipe ./main/recipe.yml --output ./runtime

            - name: Compress runtime
              run: tar -czvf runtime.tar.gz runtime

            - name: Upload runtime
              uses: actions/upload-artifact@v3
              with:
                name: runtime
                path: runtime.tar.gz



